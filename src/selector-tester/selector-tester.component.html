<div>
  <label [for]="selectorKey()" class="flex items-center space-x-1 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
    <span>{{ title() }}</span>
    @if (help()) {
      <span class="cursor-help text-gray-400 dark:text-gray-500" [title]="help()">
        <app-icon-info class="h-4 w-4"></app-icon-info>
      </span>
    }
  </label>
  <div class="flex items-center space-x-2">
    <input [id]="selectorKey()" type="text" [formControl]="control()" [placeholder]="placeholder()" class="flex-grow bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm text-gray-800 dark:text-gray-50 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500">
    <button (click)="testSelector()" class="px-3 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200 text-sm rounded-md shrink-0" title="Test Selector">Test</button>
  </div>
  @if (state(); as currentState) {
    <div class="mt-2 p-2 rounded-md text-sm animate-fade-in-fast">
        @if(currentState.isLoading) {
          <div class="flex items-center space-x-1 text-gray-500 dark:text-gray-400">
            <app-icon-spinner class="h-4 w-4"></app-icon-spinner>
            <span>Testing...</span>
          </div>
        }
        @if(currentState.error) { <div class="text-red-600 dark:text-red-500 bg-red-100 dark:bg-red-900/30 p-2 rounded"><strong>Error:</strong> {{ currentState.error }}</div> }
        @if(currentState.result) {
          <div class="bg-green-100 dark:bg-green-900/30 p-2 rounded space-y-1">
            <p class="font-bold text-green-800 dark:text-green-300">âœ“ {{ title() }} Found!</p>
            @if(isArray()) {
              <p class="text-xs text-green-700 dark:text-green-400">Found {{ currentState.result.length }} items. Showing first 5:</p>
              <ul class="list-disc list-inside text-xs text-gray-800 dark:text-gray-300 max-h-28 overflow-y-auto pl-2">
                @for(res of currentState.result.slice(0, 5); track $index) {<li>{{ res }}</li>}
              </ul>
            } @else {
              <pre class="text-xs text-gray-800 dark:text-gray-300 whitespace-pre-wrap break-words max-h-28 overflow-y-auto"><code>{{ currentState.result }}</code></pre>
            }
          </div>
        }
    </div>
  }
</div>
